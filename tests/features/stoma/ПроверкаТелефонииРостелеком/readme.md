# Проверка и создание Проверка телефонии Ростелеком   

Для автотестирования созданы следующие фича-файлы:

- **`ПроверкаТелефонииРостелеком   `**
- **`Export_ПроверкаТелефонииРостелеком   `**

#### Описание автотеста проверки Отчёты

## Загрузка данных

Этот автотест полностью проверяет сложный сценарий обработки входящих звонков пациента через телефонию Ростелеком — от первого поступления вызова до завершения звонка, работы с чёрным списком, создания сделки и заявок. В начале тест подготавливает систему к работе: запускает клиентское приложение в чистом состоянии, очищает все переменные и создаёт нового врача и нового пациента, чтобы все проверки выполнялись на «чистых» данных.

Далее тест имитирует входящий звонок от нового пациента со случайного номера. Этот номер запоминается, после чего система формирует карточку входящего звонка. Проверяется, что окно звонка открывается корректно, что в нём правильно отображаются дата и время, информация о переадресации, статус приёма, договор, полис, метки состояния, а также что все текстовые поля (ФИО, заметки, поиск пациента) изначально пустые. Таким образом проверяется корректная загрузка интерфейса и медицинского контекста звонка.

После этого тест переходит в историю вызовов и проверяет, что звонок корректно сохранился как входящий разговор с правильным временем, номером пациента, телефоном клиники, сотрудником и статусом «Разговор». В карточке звонка тест заполняет подробную заметку о разговоре, а также автоматически генерирует и заполняет фамилию, имя и отчество пациента, проверяя, что эти данные корректно сохраняются.

Затем тест проверяет бизнес-логику работы с записью пациента: сначала выполняется попытка записать пациента на приём, затем — запись в лист ожидания с указанием сотрудника и желаемой даты на конец следующего месяца. Это подтверждает, что после звонка можно сразу выстраивать дальнейшую медицинскую работу с пациентом.

Далее проверяется кнопка «Перезвонить»: при попытке исходящего вызова система корректно возвращает сетевую ошибку, что подтверждает правильную обработку нештатных ситуаций. После этого тест проверяет сценарий «Не удалось записать на приём» с указанием причины «Нет свободных слотов» и убеждается, что информация по звонку остаётся корректной и не теряется.

Отдельный важный блок теста посвящён чёрному списку. Звонок помечается как «не от пациента», номер добавляется в чёрный список, создаётся причина блокировки, после чего снова открывается карточка звонка и проверяется, что отображается причина блокировки, сохраняются все ранее введённые заметки, а статус приёма и медицинские метки остаются корректными. Затем номер удаляется из чёрного списка, что подтверждает обратимость этого действия.

После этого тест помечает звонок как «не связанный с приёмом», завершает звонок и повторно проверяет итоговую запись в истории вызовов. Убеждается, что фиксируется статус пациента «Отказ», результат звонка «Звонок не связан с приёмом», а сам звонок помечается как успешно завершённый с сохранением ФИО пациента.

Дополнительно проверяется открытие карточки клиента из истории вызовов, а также корректная работа всех кнопок «Позвонить» — как из истории, так и из сделки и заявки. Во всех случаях система должна корректно обрабатывать сетевую ошибку при попытке исходящего вызова.

Также тест проверяет, что на основании звонка создаётся сделка с правильными данными: ФИО пациента, рекламный источник «Входящий звонок», статус пациента «Новый» и этап «Отказ, Не удалось записать». Это подтверждает связку между телефонией, пациентом и коммерческими сущностями системы.

В завершение тест отдельно проверяет сценарий пропущенного звонка: создаётся новый номер, звонок помечается как пропущенный, проверяется его отображение в истории вызовов со статусом «Пропущен», после чего проверяется корректность интерфейса карточки пропущенного звонка — отображение времени, номера, медицинских меток и отсутствие заполненных персональных данных.

В итоге данный автотест полностью покрывает весь жизненный цикл входящего звонка пациента: от первичного звонка и медицинского контекста до истории вызовов, чёрного списка, сделок, заявок, отказов, пропущенных звонков и проверки устойчивости системы к ошибкам связи.
