# Описание автотестов по оплатам.

Для автотестирования созданы следующие сценарии:

-   **`Возвраты.`**
-   **`Проверка НДС (VAT).`**
-   **`Проверка НДС(VAT) по цене.`**
-   **`Проверка PaymentMethod 1-7.`**
-   **`Проверка TaxationSystem 0-5.`**

### Описание сценариев автотеста "Проверка НДС (VAT)".
<details><summary>Выпадающий список</summary>

-   **Сценарий: 01. Первоначальная настройка**

Еще до настроек у нас в блоке переменных запонимаются следующие значения:

-   VATRate_Услуга_2 =	"20"
-   VATAmount_Услуга_2 = "116.67"
-   СтавкаНДС_Услуга_2 = 20"
-   СуммаНДС_Услуга_2 = "116,67"

Удаляются все переменные. Через регистр сведений "ПрименениеСистемНалогообложения" удаляются все строки что в нем есть. Удаляются все объекты без контроля ссылок в справочнике Ставки НДС(за исключение предопределенных, их этот шаг удалить не может). После удаления ставок НДС создаются новые через экспортный сценарий.

После создания новых ставок НДС переходится в справочник "Организации" и выбирается текущая строка, после открытия организации в ней в полях налогообалежния для товара, аванса, услуги выставляется общая система налооблажения и ставка НДС "Без НДС". Также создается еще одно поле, но уже со своей группой и со своими настройка СНО = Общая, НДС = 20%.

После настройки организации создаются следующие объекты: Клиент, мастер, услуга салона красоты 1 и 2. Во второй услуге выставляется своя группа налогооблажения.

-   **Сценарий: 02. В чеке "VATRate=none"**

Происходит проверка прошлого сценария на ошибки, если ошибки были, то весь фича файл останавливает своё выполнение. Потом заходится в организацию и в ней еще раз выбирает для всех позиций ставка НДС "Без НДС".

Запускается экспортный сценарий "Я проверяю xml реализации НДС (VAT)". В нем создается продажа в которой потом генерируются переменные для проверка XML чека и для проверки текстового чека.

Запускается потом другой экспортный сценарий "Я проверяю xml возврата реализации НДС (VAT)". Создается возврат по продаже, также генерируются переменные для провки чека XML и текстового.

Запускается потом экспортный сценарий "Я проверяю xml с приорететом номенклатуры реализации НДС (VAT)". Где уже делаетс продажа второй услуги салона красоты, где находится своя группа налогооблажения.

-   **Сценарий: 03. В чеке "VATRate=0"**
-   **Сценарий: 04. В чеке "VATRate=5"**
-   **Сценарий: 05. В чеке "VATRate=7"**
-   **Сценарий: 06. В чеке "VATRate=10"**
-   **Сценарий: 07. В чеке "VATRate=18"**
-   **Сценарий: 08. В чеке "VATRate=20"**

Эти сценарии работают на аналогии с тем, что описан выше, сначала идет запись переменных, затем смена ставки НДС в организации, а потом проверка чеков с помощью трех экспортный сценариев.

-   **Сценарий: 09. Очистка поля СтавкаНДС в Организации**

Открывается организация, в ней удаляется отдельная группа налогображения и везде выставляется ставка НДС "Без НДС".

</details>

### Описание сценариев автотеста "Проверка НДС(VAT) по цене".

<details><summary>Выпадающий список</summary>

-   **Сценарий: 01. Первоначальная настройка**
-   **Сценарий: 02. В чеке "VATRate=none"**
-   **Сценарий: 03. В чеке "VATRate=0"**
-   **Сценарий: 04. В чеке "VATRate=5"**
-   **Сценарий: 05. В чеке "VATRate=7"**
-   **Сценарий: 06. В чеке "VATRate=10"**
-   **Сценарий: 07. В чеке "VATRate=18"**
-   **Сценарий: 08. В чеке "VATRate=20"**
-   **Сценарий: 09. Возврат к исходному состоянию**

По своей сути, все эти сценарии реализованы точно также, как прошлый фича файл, за исключением того, как проверяются все эти ставки НДС.

А проверяются они с помощью других экспортный сценариев, таких как: Я проверяю xml реализации НДС (VAT) по цене, Я проверяю xml возврата реализации НДС (VAT) по цене.

</details>

### Описание сценариев автотеста "Проверка TaxationSystem 0-5".

<details><summary>Выпадающий список</summary>

-   **Сценарий: 01. Первоначальная настройка**

Удаляются все переменные. Создается мастер, пакет услуг, клиент и случайное число.

Из регистра сведений "ПрименениеСистемНалогообложения" удаляются все записи по СНО. Удаляются также все ставки НДС из справочника "Ставки НДС" и создаются новые.

В организации выставляются для товаров, услуг и авансов СНО - Общая, НДС - Без НДС и добавляется отдельная группа налогоблажения. И эта группа добавляется в созданный пакет услуг.

-   **Сценарий: 02. СистемаНалогообложенияДляУслуг - Общая - 0**
-   **Сценарий: 03. СистемаНалогообложенияДляУслуг - Упрощенная доход - 1**
-   **Сценарий: 04. СистемаНалогообложенияДляУслуг - Упрощенная доход минус расход - 2**
-   **Сценарий: 05. СистемаНалогообложенияДляУслуг - Единый налог на вмененный доход - 3**
-   **Сценарий: 06. СистемаНалогообложенияДляУслуг - Единый сельскохозяйственный налог - 4**
-   **Сценарий: 08. СистемаНалогообложенияДляУслуг - Патентная система налогообложения - 5**

В каждом сценарии создается визит, оплачивается и проверяется его XML в зависимости от того какая СНО в сценарии была настроена для проверки. Потом делается проверка через возврат.

-   **Сценарий: 09. Возврат в исходное состояние**

В организации выставляются для товаров, услуг и авансов СНО - Общая, НДС - Без НДС и удаляется отдельная группа налогоблажения.

</details>

### Описание сценариев автотеста "Проверка PaymentMethod 1-7".

<details><summary>Выпадающий список</summary>

-   **Сценарий: 01. Первоначальная настройка**

Устанавливается константа "НеКонтролироватьЗанятостьМастера". Создается клиент, мастер, услуга, случайное число.

Очищается регистр сведений "ПрименениеСистемНалогообложения". Удаляются все ставки НДС и создаются собственные. В организации для товаров, услуг и авансов выставляется СНО - Общая, НДС - Без НДС.

-   **Сценарий: 02. Проверка PaymentMethod 3**

Создается документа Курс и по нему делают взнос Аванса. Затем проверяется XML чек

-   **Сценарий: 03. Проверка PaymentMethod 4**

Создается документ Визит и оплачивается. Затем прооверяется XML чек.

-   **Сценарий: 04. Проверка PaymentMethod 5**

Создается документ Визит и частично оплачивается.

-   **Сценарий: 05. Проверка PaymentMethod 7**

Открывается навиг.ссылка визита из сценария 04 и оплачивается по этому визиту задолженность, и проверяется XML.

</details>

### Описание сценариев автотеста "Возвраты".

<details><summary>Выпадающий список</summary>

-   **Сценарий: 01. Первоначальная настройка**

Удаляются все переменные. Создаются клиент, мастер, услуга. Удаляются все ставки НДС и создаются новые. В организации настраивается налогооблажение для товаров, услуг и авансов СНО - Общая, НДС - Без НДС.

-   **Сценарий: 02. OperationType-2 (полный возврат)**

Создается продажа, оплачивается и по ней делается возврат, после возврата проверяется XML чек.

-   **Сценарий: 03. OperationType-2 (частичный возврат номенклатуры)**

Создается продажа, оплачивается и по ней делается частичный возврат, после возврата проверяется XML чек.

-   **Сценарий: 04. OperationType-2 (последовательный возврат номенклатуры)**

Создается возврат на оставшиеся кол-во номенклатуры по прошлой продаже(первый раз вернули 0.3, сейчас возвращаем 0.7).

-   **Сценарий: 05. OperationType-2 (частичный возврат средств)**

Создается продажа и оплачивается. Затем делается возврат на неполную сумму и проверяется чек XML.

-   **Сценарий: 06. OperationType-2 (Отмена ошибочной оплаты)**


Создается продажа и оплачивается. Затем делается отмена ошибочной оплаты и проверяется чек XML.

</details>








