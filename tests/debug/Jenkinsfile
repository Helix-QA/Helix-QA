properties([
    parameters([
        // Первый параметр (одиночный выбор)
        [
            $class: 'ChoiceParameter',
            choiceType: 'PT_SINGLE_SELECT',
            name: 'ENVIRONMENT',
            description: 'Выберите окружение',
            script: [
                $class: 'GroovyScript',
                script: '''
                    return ["dev", "prod", "stage"]
                '''
            ]
        ],
        // Второй параметр (мультиселект)
        [
            $class: 'CascadeChoiceParameter',
            name: 'SERVICES',  // Обратите внимание на множественное число
            description: 'Выберите сервисы (можно несколько)',
            choiceType: 'PT_CHECKBOX',  // Или PT_MULTI_SELECT
            referencedParameters: 'ENVIRONMENT',
            script: [
                $class: 'GroovyScript',
                script: '''
                    if (ENVIRONMENT == "dev") {
                        return ["frontend-dev", "backend-dev", "db-dev", "cache-dev"]
                    } else if (ENVIRONMENT == "prod") {
                        return ["frontend-prod", "backend-prod", "db-prod", "cache-prod"]
                    } else {
                        return ["frontend-stage", "backend-stage", "monitoring-stage"]
                    }
                '''
            ]
        ]
    ])
])

pipeline {
    agent any
    stages {
        stage('Run') {
            steps {
                script {
                    echo "Выбрано окружение: ${params.ENVIRONMENT}"
                    echo "Выбранные сервисы: ${params.SERVICES}"  // Будет списком
                    // Если нужно обработать каждый выбранный сервис:
                    if (params.SERVICES) {
                        params.SERVICES.each { service ->
                            echo "Обрабатываем сервис: ${service}"
                        }
                    }
                }
            }
        }
    }
}